<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Info Explorer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            color: #334155; /* Darker text */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* Rounded corners */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }
        .card:hover {
            transform: translateY(-5px); /* Slight lift on hover */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.15); /* More pronounced shadow */
        }
        .flag-img {
            width: 100%;
            height: 150px; /* Fixed height for flags */
            object-fit: cover;
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #ffffff;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }
        .compare-section {
            background-color: #e2e8f0; /* Lighter blue-gray for compare section */
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 2rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
        }
        .compare-card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body class="antialiased">
    <div class="container">
        <!-- Header -->
        <header class="text-center py-8 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl shadow-lg mb-8">
            <h1 class="text-4xl font-bold tracking-tight">üåç Country Info Explorer</h1>
            <p class="mt-2 text-lg opacity-90">Discover fascinating facts about countries worldwide!</p>
        </header>

        <!-- Search and Filter Section -->
        <section class="mb-8 p-6 bg-white rounded-xl shadow-md flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
            <input type="text" id="searchInput" placeholder="Search for a country..." class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
            <button id="searchButton" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200 ease-in-out">
                Search
            </button>
            <button id="clearSearchButton" class="px-6 py-3 bg-gray-400 text-white font-semibold rounded-lg shadow-md hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-200 ease-in-out">
                Clear Search
            </button>
        </section>

        <!-- Compare Countries Section -->
        <section class="compare-section mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Compare Countries</h2>
            <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 mb-6">
                <select id="country1Select" class="p-3 border border-gray-300 rounded-lg w-full md:w-1/3 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                    <option value="">Select Country 1</option>
                </select>
                <span class="text-xl font-bold text-gray-600">VS</span>
                <select id="country2Select" class="p-3 border border-gray-300 rounded-lg w-full md:w-1/3 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                    <option value="">Select Country 2</option>
                </select>
                <button id="compareButton" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-200 ease-in-out w-full md:w-auto">
                    Compare
                </button>
            </div>
            <div id="comparisonResult" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Comparison results will be displayed here -->
            </div>
        </section>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="text-center py-8 text-gray-600 text-lg font-medium hidden">
            Loading countries...
        </div>

        <!-- Country Cards Grid -->
        <section id="countryCardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Country cards will be dynamically loaded here -->
        </section>

        <!-- Country Details Modal -->
        <div id="countryDetailsModal" class="modal-overlay hidden">
            <div class="modal-content">
                <button class="close-button" id="closeModalButton">&times;</button>
                <div id="modalContentBody">
                    <!-- Country details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables to store country data
        let allCountriesData = [];

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const clearSearchButton = document.getElementById('clearSearchButton');
        const countryCardsContainer = document.getElementById('countryCardsContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const countryDetailsModal = document.getElementById('countryDetailsModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const modalContentBody = document.getElementById('modalContentBody');
        const country1Select = document.getElementById('country1Select');
        const country2Select = document.getElementById('country2Select');
        const compareButton = document.getElementById('compareButton');
        const comparisonResult = document.getElementById('comparisonResult');

        /**
         * Fetches all countries data from the RESTCountries API with a retry mechanism.
         * Initially fetches only essential fields for display.
         * @param {number} retries - The number of remaining retries.
         */
        async function fetchCountries(retries = 3) {
            loadingIndicator.classList.remove('hidden');
            try {
                // Fetch only essential fields for initial display to avoid 400 errors on /all
                const fields = 'name,flags,population,region,capital,cca3'; // Added cca3 for detailed fetch
                const response = await fetch(`https://restcountries.com/v3.1/all?fields=${fields}`);

                if (!response.ok) {
                    console.error(`HTTP error! Status: ${response.status}, Status Text: ${response.statusText}`);
                    if (retries > 0) {
                        console.log(`Retrying initial fetch... (${retries} retries left)`);
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        await fetchCountries(retries - 1);
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}. ${response.statusText || 'Unknown error.'}`);
                }
                allCountriesData = await response.json();
                allCountriesData.sort((a, b) => a.name.common.localeCompare(b.name.common));
                displayCountries(allCountriesData);
                populateCompareDropdowns(allCountriesData);
            } catch (error) {
                console.error('Error fetching countries:', error);
                countryCardsContainer.innerHTML = `<p class="text-red-600 text-center col-span-full">Failed to load countries. An API error occurred: ${error.message}. Please check your network connection or try again later.</p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        /**
         * Displays a list of countries in the main container.
         * @param {Array} countries - An array of country objects.
         */
        function displayCountries(countries) {
            countryCardsContainer.innerHTML = '';
            if (countries.length === 0) {
                countryCardsContainer.innerHTML = `<p class="text-gray-600 text-center col-span-full">No countries found matching your search.</p>`;
                return;
            }
            countries.forEach(country => {
                countryCardsContainer.appendChild(createCountryCard(country));
            });
        }

        /**
         * Creates an HTML card element for a given country.
         * @param {Object} country - The country object.
         * @returns {HTMLElement} The country card element.
         */
        function createCountryCard(country) {
            const card = document.createElement('div');
            card.className = 'card bg-white rounded-xl shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300 ease-in-out';
            card.innerHTML = `
                <img src="${country.flags.png}" alt="${country.name.common} flag" class="flag-img">
                <div class="p-6">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">${country.name.common}</h3>
                    <p class="text-gray-600 mb-1"><strong class="font-medium">Population:</strong> ${country.population ? country.population.toLocaleString() : 'N/A'}</p>
                    <p class="text-gray-600 mb-1"><strong class="font-medium">Region:</strong> ${country.region || 'N/A'}</p>
                    <p class="text-gray-600"><strong class="font-medium">Capital:</strong> ${country.capital ? country.capital[0] : 'N/A'}</p>
                </div>
            `;
            card.addEventListener('click', () => showCountryDetails(country.cca3)); // Pass cca3 for detailed fetch
            return card;
        }

        /**
         * Displays detailed information about a selected country in a modal.
         * Fetches full details for the specific country using its cca3 code.
         * @param {string} cca3 - The 3-letter country code.
         */
        async function showCountryDetails(cca3) {
            modalContentBody.innerHTML = `<p class="text-center text-gray-600">Loading details...</p>`;
            countryDetailsModal.classList.remove('hidden');

            try {
                const response = await fetch(`https://restcountries.com/v3.1/alpha/${cca3}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}. ${response.statusText || 'Unknown error.'}`);
                }
                const country = (await response.json())[0]; // API returns an array, take the first element

                modalContentBody.innerHTML = `
                    <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
                        <img src="${country.flags.png}" alt="${country.name.common} flag" class="w-48 h-32 md:w-64 md:h-48 object-cover rounded-lg shadow-md">
                        <div class="flex-1">
                            <h2 class="text-3xl font-bold text-gray-900 mb-3">${country.name.common}</h2>
                            <p class="text-gray-700 text-lg mb-4"><strong>Official Name:</strong> ${country.name.official || 'N/A'}</p>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2 text-gray-700">
                                <p><strong>Capital:</strong> ${country.capital ? country.capital[0] : 'N/A'}</p>
                                <p><strong>Region:</strong> ${country.region || 'N/A'}</p>
                                <p><strong>Sub-region:</strong> ${country.subregion || 'N/A'}</p>
                                <p><strong>Population:</strong> ${country.population ? country.population.toLocaleString() : 'N/A'}</p>
                                <p><strong>Area:</strong> ${country.area ? country.area.toLocaleString() + ' km¬≤' : 'N/A'}</p>
                                <p><strong>Languages:</strong> ${country.languages ? Object.values(country.languages).join(', ') : 'N/A'}</p>
                                <p><strong>Currencies:</strong> ${country.currencies ? Object.values(country.currencies).map(c => `${c.name} (${c.symbol})`).join(', ') : 'N/A'}</p>
                                <p><strong>Timezones:</strong> ${country.timezones ? country.timezones.join(', ') : 'N/A'}</p>
                                <p><strong>Continents:</strong> ${country.continents ? country.continents.join(', ') : 'N/A'}</p>
                                <p><strong>Driving Side:</strong> ${country.car && country.car.side ? country.car.side : 'N/A'}</p>
                                <p><strong>Start of Week:</strong> ${country.startOfWeek || 'N/A'}</p>
                            </div>
                            <div class="mt-6">
                                <h3 class="text-xl font-semibold text-gray-800 mb-2">Borders:</h3>
                                <p class="text-gray-700">
                                    ${country.borders && country.borders.length > 0 ? country.borders.map(borderCode => {
                                        const borderCountry = allCountriesData.find(c => c.cca3 === borderCode);
                                        return borderCountry ? borderCountry.name.common : borderCode;
                                    }).join(', ') : 'No bordering countries'}
                                </p>
                            </div>
                            <div class="mt-6">
                                <h3 class="text-xl font-semibold text-gray-800 mb-2">Map:</h3>
                                ${country.maps && country.maps.googleMaps ? `<a href="${country.maps.googleMaps}" target="_blank" class="text-blue-600 hover:underline">View on Google Maps</a>` : 'Map not available'}
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error fetching country details:', error);
                modalContentBody.innerHTML = `<p class="text-red-600 text-center">Failed to load country details. An API error occurred: ${error.message}.</p>`;
            }
        }

        /**
         * Populates the country selection dropdowns for the comparison feature.
         * @param {Array} countries - An array of country objects.
         */
        function populateCompareDropdowns(countries) {
            country1Select.innerHTML = '<option value="">Select Country 1</option>';
            country2Select.innerHTML = '<option value="">Select Country 2</option>';

            countries.forEach(country => {
                const option1 = document.createElement('option');
                option1.value = country.name.common;
                option1.textContent = country.name.common;
                country1Select.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = country.name.common;
                option2.textContent = country.name.common;
                country2Select.appendChild(option2);
            });
        }

        /**
         * Compares two selected countries and displays their information side-by-side.
         */
        async function compareCountries() {
            const country1Name = country1Select.value;
            const country2Name = country2Select.value;

            if (!country1Name || !country2Name) {
                comparisonResult.innerHTML = `<p class="text-red-600 text-center col-span-full">Please select two countries to compare.</p>`;
                return;
            }

            // Find the cca3 codes for the selected countries from the initially loaded data
            const country1Cca3 = allCountriesData.find(c => c.name.common === country1Name)?.cca3;
            const country2Cca3 = allCountriesData.find(c => c.name.common === country2Name)?.cca3;

            if (!country1Cca3 || !country2Cca3) {
                comparisonResult.innerHTML = `<p class="text-red-600 text-center col-span-full">Could not find data for selected countries.</p>`;
                return;
            }

            comparisonResult.innerHTML = `<p class="text-center text-gray-600 col-span-full">Loading comparison data...</p>`;

            try {
                const [response1, response2] = await Promise.all([
                    fetch(`https://restcountries.com/v3.1/alpha/${country1Cca3}`),
                    fetch(`https://restcountries.com/v3.1/alpha/${country2Cca3}`)
                ]);

                if (!response1.ok || !response2.ok) {
                    throw new Error(`One or both country detail fetches failed. Statuses: ${response1.status}, ${response2.status}`);
                }

                const country1 = (await response1.json())[0];
                const country2 = (await response2.json())[0];

                comparisonResult.innerHTML = `
                    ${createComparisonCard(country1)}
                    ${createComparisonCard(country2)}
                `;
            } catch (error) {
                console.error('Error comparing countries:', error);
                comparisonResult.innerHTML = `<p class="text-red-600 text-center col-span-full">Failed to compare countries. An API error occurred: ${error.message}.</p>`;
            }
        }

        /**
         * Creates an HTML card for country comparison.
         * @param {Object} country - The country object.
         * @returns {string} HTML string for the comparison card.
         */
        function createComparisonCard(country) {
            return `
                <div class="compare-card p-6 bg-white rounded-xl shadow-md">
                    <img src="${country.flags.png}" alt="${country.name.common} flag" class="w-24 h-16 object-cover rounded-md mb-4 mx-auto">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3 text-center">${country.name.common}</h3>
                    <ul class="space-y-2 text-gray-700">
                        <li><strong>Official Name:</strong> ${country.name.official || 'N/A'}</li>
                        <li><strong>Capital:</strong> ${country.capital ? country.capital[0] : 'N/A'}</li>
                        <li><strong>Region:</strong> ${country.region || 'N/A'}</li>
                        <li><strong>Population:</strong> ${country.population ? country.population.toLocaleString() : 'N/A'}</li>
                        <li><strong>Area:</strong> ${country.area ? country.area.toLocaleString() + ' km¬≤' : 'N/A'}</li>
                        <li><strong>Languages:</strong> ${country.languages ? Object.values(country.languages).join(', ') : 'N/A'}</li>
                        <li><strong>Currencies:</strong> ${country.currencies ? Object.values(country.currencies).map(c => `${c.name} (${c.symbol})`).join(', ') : 'N/A'}</li>
                        <li><strong>Timezones:</strong> ${country.timezones ? country.timezones.join(', ') : 'N/A'}</li>
                        <li><strong>Driving Side:</strong> ${country.car && country.car.side ? country.car.side : 'N/A'}</li>
                        <li><strong>Google Maps:</strong> ${country.maps && country.maps.googleMaps ? `<a href="${country.maps.googleMaps}" target="_blank" class="text-blue-600 hover:underline">View Map</a>` : 'N/A'}</li>
                    </ul>
                </div>
            `;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => fetchCountries(3));

        searchButton.addEventListener('click', () => {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredCountries = allCountriesData.filter(country =>
                country.name.common.toLowerCase().includes(searchTerm) ||
                (country.capital && country.capital[0].toLowerCase().includes(searchTerm)) ||
                (country.region && country.region.toLowerCase().includes(searchTerm))
            );
            displayCountries(filteredCountries);
        });

        clearSearchButton.addEventListener('click', () => {
            searchInput.value = '';
            displayCountries(allCountriesData);
        });

        closeModalButton.addEventListener('click', () => {
            countryDetailsModal.classList.add('hidden');
        });

        countryDetailsModal.addEventListener('click', (e) => {
            if (e.target === countryDetailsModal) {
                countryDetailsModal.classList.add('hidden');
            }
        });

        compareButton.addEventListener('click', compareCountries);

    </script>
</body>
</html>
